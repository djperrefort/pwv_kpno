<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pwv_kpno.package_settings &#8212; pwv_kpno 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom_style.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../documentation/html/index.html">
          pwv_kpno</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../../documentation/html/overview.html">Documentation</a></li>
                <li><a href="../../../../examples/html/correcting_spectra.html">Examples</a></li>
                <li><a href="../../../../validation/html/overview.html">Validation</a></li>
                <li><a href="https://github.com/mwvgroup/pwv_kpno/issues/new/choose">Need Help?</a></li>
                <li><a href="https://github.com/mwvgroup/pwv_kpno">Source Code</a></li>
            
            
            
            
            
          </ul>

          
                 
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for pwv_kpno.package_settings</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>

<span class="c1">#    This file is part of the pwv_kpno software package.</span>
<span class="c1">#</span>
<span class="c1">#    The pwv_kpno package is free software: you can redistribute it and/or</span>
<span class="c1">#    modify it under the terms of the GNU General Public License as published</span>
<span class="c1">#    by the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">#    (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#    The pwv_kpno package is distributed in the hope that it will be useful,</span>
<span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General</span>
<span class="c1">#    Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#    You should have received a copy of the GNU General Public License</span>
<span class="c1">#    along with pwv_kpno. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>


<span class="sd">&quot;&quot;&quot;This code provides access to package wide settings for the pwv_kpno package</span>

<span class="sd">Access to current package settings is provided by the `settings` object.</span>
<span class="sd">Configuration files used to model the atmosphere at a custom site can be</span>
<span class="sd">created using the `ConfigBuilder` class.</span>

<span class="sd">For full documentation on a function use the builtin Python `help` function</span>
<span class="sd">or see https://mwvgroup.github.io/pwv_kpno/.</span>

<span class="sd">An incomplete guide to getting started:</span>

<span class="sd">    For an overview of package settings:</span>

<span class="sd">      &gt;&gt;&gt; from pwv_kpno.package_settings import settings</span>
<span class="sd">      &gt;&gt;&gt; print(settings)</span>


<span class="sd">    To get a list of sites that this installation of pwv_kpno has been</span>
<span class="sd">    configured to model:</span>

<span class="sd">      &gt;&gt;&gt; print(settings.available_sites)</span>


<span class="sd">    To model the time dependent atmosphere at a specific site:</span>

<span class="sd">      &gt;&gt;&gt; settings.set_site(&lt;site_name&gt;)</span>


<span class="sd">    To export the config file for the current site being modeled:</span>

<span class="sd">      &gt;&gt;&gt; settings.export_site_config(&lt;out_path&gt;)</span>


<span class="sd">    To import a config file for a new site, and permanently add it to the</span>
<span class="sd">    package:</span>

<span class="sd">      &gt;&gt;&gt; settings.import_site_config(&lt;config_path&gt;, overwrite=False)</span>
<span class="sd">      &gt;&gt;&gt; settings.set_site(&lt;new_site_name&gt;)  # To model the imported site</span>


<span class="sd">    To create a config file for a given site use the below. Further options</span>
<span class="sd">    for specifying custom H2O cross sections, and data cuts for downloaded</span>
<span class="sd">    SuomiNet data are outlined in the online documentation.</span>

<span class="sd">      &gt;&gt;&gt; new_config = ConfigBuilder(</span>
<span class="sd">      &gt;&gt;&gt;     site_name=&#39;custom_kitt_peak&#39;,     # Required name for modeled site</span>
<span class="sd">      &gt;&gt;&gt;     primary_rec=&#39;KITT&#39;,               # Required primary receiver</span>
<span class="sd">      &gt;&gt;&gt;     supplement_rec=[&#39;AZAM&#39;, &#39;SA48&#39;],  # Optional secondary receivers</span>
<span class="sd">      &gt;&gt;&gt; )</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="k">import</span> <span class="n">Table</span>

<span class="kn">from</span> <span class="nn">._atm_model</span> <span class="k">import</span> <span class="n">create_pwv_atm_model</span>

<span class="n">__authors__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Daniel Perrefort&#39;</span><span class="p">]</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s1">&#39;Copyright 2017, Daniel Perrefort&#39;</span>

<span class="n">__license__</span> <span class="o">=</span> <span class="s1">&#39;GPL V3&#39;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;djperrefort@pitt.edu&#39;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s1">&#39;Release&#39;</span>

<span class="c1"># Sites included with release that cannot be overwritten by the user</span>
<span class="n">PROTECTED_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;kitt_peak&#39;</span><span class="p">]</span>

<span class="c1"># List of params that data cuts can be applied for</span>
<span class="n">CUT_PARAMS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PWV&#39;</span><span class="p">,</span> <span class="s1">&#39;PWVerr&#39;</span><span class="p">,</span> <span class="s1">&#39;ZenithDelay&#39;</span><span class="p">,</span> <span class="s1">&#39;SrfcPress&#39;</span><span class="p">,</span> <span class="s1">&#39;SrfcTemp&#39;</span><span class="p">,</span> <span class="s1">&#39;SrfcRH&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ModelingConfigError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">site_property</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="c1"># A custom wrapper that requires the _site_name attribute to not be None</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;No site has been specified for pwv_kpno model.&#39;</span>
            <span class="k">raise</span> <span class="n">ModelingConfigError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents pwv_kpno settings for a particular geographical site</span>

<span class="sd">    An overview of the current package settings can be accessed by printing</span>
<span class="sd">    this object.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        site_name       : The current site being modeled</span>
<span class="sd">        available_sites : A list of built in sites that pwv_kpno can model</span>
<span class="sd">        receivers       : A list of SuomiNet receivers used by this site</span>
<span class="sd">        primary_rec     : The SuomiNet id code for the primary GPS receiver</span>
<span class="sd">        supplement_rec  : Same as receivers but without the primary receiver</span>

<span class="sd">    Methods:</span>
<span class="sd">        set_site           : Configure pwv_kpno to model a given site</span>
<span class="sd">        export_site_config : Save the current site&#39;s configuration data to file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_site_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># The name of the current site</span>
    <span class="n">_config_data</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Data from the site&#39;s config file</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_suomi_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_file_dir</span><span class="p">,</span> <span class="s1">&#39;suomi_data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir_unf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_file_dir</span><span class="p">,</span> <span class="s1">&#39;site_data/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_path_unf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir_unf</span><span class="p">,</span> <span class="s1">&#39;config.json&#39;</span><span class="p">)</span>

        <span class="n">atm_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_file_dir</span><span class="p">,</span> <span class="s1">&#39;default_atmosphere/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_h2o_cs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atm_dir</span><span class="p">,</span> <span class="s1">&#39;h2ocs.txt&#39;</span><span class="p">)</span>
        <span class="c1"># self._o2_cs_path = os.path.join(atm_dir, &#39;o2cs.txt&#39;)</span>
        <span class="c1"># self._o3_cs_path = os.path.join(atm_dir, &#39;o3cs.txt&#39;)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">site_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type: () -&gt; str</span>
        <span class="sd">&quot;&quot;&quot;The name of the current site being modeled&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_name</span>

    <span class="nd">@site_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">site_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s1">&#39;Use the set_site method to change the site &#39;</span>
            <span class="s1">&#39;being modeled by pwv_kpno&#39;</span>
        <span class="p">)</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">primary_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type: () -&gt; str</span>
        <span class="sd">&quot;&quot;&quot;The SuomiNet ID code for the primary receiver of the current site&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">[</span><span class="s1">&#39;primary_rec&#39;</span><span class="p">]</span>

    <span class="nd">@primary_rec</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">primary_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s1">&#39;The primary receiver for a site cannot be changed. Use the &#39;</span>
            <span class="s1">&#39;set_site method to change the site being modeled by pwv_kpno&#39;</span>
        <span class="p">)</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">_loc_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir_unf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_atm_model_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir</span><span class="p">,</span> <span class="s1">&#39;atm_model.csv&#39;</span><span class="p">)</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">_config_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_path_unf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_pwv_model_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir</span><span class="p">,</span> <span class="s1">&#39;modeled_pwv.csv&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_pwv_measred_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir</span><span class="p">,</span> <span class="s1">&#39;measured_pwv.csv&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">available_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type: () -&gt; list[str]</span>
        <span class="sd">&quot;&quot;&quot;A list of sites for which pwv_kpno has stored settings&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir_unf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)))[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_site</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="c1"># type: (str) -&gt; None</span>
        <span class="sd">&quot;&quot;&quot;Configure pwv_kpno to model the default_atmosphere at a given site</span>

<span class="sd">        See the available_sites attribute for a list of available site names</span>

<span class="sd">        Args:</span>
<span class="sd">            loc (str): The name of a site to model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_sites</span><span class="p">:</span>
            <span class="n">config_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_path_unf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;No stored settings for site </span><span class="si">{}</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_site_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">_downloaded_years</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A list of years for which SuomiNet data has been downloaded</span>

<span class="sd">        If a user has attempted to download data for a given year, and no data</span>
<span class="sd">        is available for that year, the year is still included in this list. To</span>
<span class="sd">        retrieve a list of years for which any amount of SuomiNet data is</span>
<span class="sd">        available on this machine, see the _years_with_data property.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ofile</span><span class="p">)[</span><span class="s1">&#39;years&#39;</span><span class="p">])</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">_years_with_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return years with locally available data</span>

<span class="sd">        For a list of all years that have been downloaded from SuomiNet,</span>
<span class="sd">        regardless of whether any data was actually available during that year,</span>
<span class="sd">        see the _downloaded_years property.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">timestamp_column</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pwv_measred_path</span><span class="p">)[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
            <span class="n">get_year</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t_stamp</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">t_stamp</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
            <span class="n">get_year_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">get_year</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">get_year_vec</span><span class="p">(</span><span class="n">timestamp_column</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="k">def</span> <span class="nf">_replace_years</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yr_list</span><span class="p">):</span>
        <span class="c1"># Replaces the list of downloaded years in the site&#39;s config file</span>

        <span class="c1"># Note: self._config_path calls @site_property decorator</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_path</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">current_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>
            <span class="n">current_data</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">yr_list</span><span class="p">))</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">current_data</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type: () -&gt; list[str]</span>
        <span class="sd">&quot;&quot;&quot;A list of all GPS receivers associated with the current site&quot;&quot;&quot;</span>

        <span class="c1"># list used instead of .copy for python 2.7 compatibility</span>
        <span class="n">rec_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">[</span><span class="s1">&#39;sup_rec&#39;</span><span class="p">])</span>
        <span class="n">rec_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">[</span><span class="s1">&#39;primary_rec&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rec_list</span><span class="p">)</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">supplement_rec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type () -&gt; list[str]</span>
        <span class="sd">&quot;&quot;&quot;A list of all supplementary GPS receivers for the current site&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">[</span><span class="s1">&#39;sup_rec&#39;</span><span class="p">])</span>

    <span class="nd">@site_property</span>
    <span class="k">def</span> <span class="nf">data_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type () -&gt; dict</span>
        <span class="sd">&quot;&quot;&quot;Returns restrictions on what SuomiNet measurements to include&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">[</span><span class="s1">&#39;data_cuts&#39;</span><span class="p">]</span>

    <span class="nd">@data_cuts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">[</span><span class="s1">&#39;data_cuts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_path</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ofile</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">export_site_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">):</span>
        <span class="c1"># type: (str) -&gt; None</span>
        <span class="sd">&quot;&quot;&quot;Save the current site&#39;s config file in ecsv format</span>

<span class="sd">        Args:</span>
<span class="sd">            out_path (str): The desired output file path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">out_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.ecsv&#39;</span><span class="p">):</span>
            <span class="n">out_path</span> <span class="o">+=</span> <span class="s1">&#39;.ecsv&#39;</span>

        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>

        <span class="n">atm_model</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm_model_path</span><span class="p">)</span>
        <span class="n">atm_model</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_data</span>
        <span class="n">atm_model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_site_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">force_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># type: (str, bool) -&gt; None</span>
        <span class="sd">&quot;&quot;&quot;Load a custom configuration file and save it to the package</span>

<span class="sd">        Existing sites are only overwritten if overwrite is set to True.</span>
<span class="sd">        The imported site can be assigned an alternative name using the</span>
<span class="sd">        forced_name argument.</span>

<span class="sd">        Args:</span>
<span class="sd">            path       (str): The path of a pwv_kpno config file</span>
<span class="sd">            force_name (str): Optional site name to overwrite config file</span>
<span class="sd">            overwrite (bool): Whether to overwrite an existing site</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.ecsv&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">force_name</span><span class="p">:</span>
            <span class="n">config_data</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">force_name</span><span class="p">)</span>

        <span class="n">loc_name</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">loc_name</span> <span class="ow">in</span> <span class="n">PROTECTED_NAMES</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;Cannot overwrite protected site name </span><span class="si">{}</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc_name</span><span class="p">))</span>

        <span class="n">out_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_dir_unf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;Site already exists </span><span class="si">{}</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc_name</span><span class="p">))</span>

        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s1">&#39;_temp&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s1">&#39;config.json&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
            <span class="n">config_data</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;years&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_data</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">atm_model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s1">&#39;atm_model.csv&#39;</span><span class="p">)</span>
        <span class="n">config_data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">atm_model_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.csv&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s1">&#39;&lt;pwv_kpno.Settings, Current Site Name: </span><span class="si">{}</span><span class="s1">&gt;&#39;</span>
        <span class="k">return</span> <span class="n">rep</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_status_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the header for the class string representation&quot;&quot;&quot;</span>

        <span class="n">status_table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;                     pwv_kpno Current Site Information</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;============================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Site Name:            </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Primary Receiver:     </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Secondary Receivers:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;    </span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Years Downloaded from SuomiNet:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;                                 Data Cuts</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;============================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Reveiver    Value       Type          Lower_Bound          Upper_Bound  unit</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;----------------------------------------------------------------------------&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplement_rec</span><span class="p">:</span>
            <span class="n">receivers</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supplement_rec</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">receivers</span> <span class="o">=</span> <span class="s1">&#39;    NONE&#39;</span>

        <span class="n">years_downloaded_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">years_with_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_years_with_data</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloaded_years</span><span class="p">:</span>
            <span class="n">years_downloaded_str</span> <span class="o">+=</span> <span class="s1">&#39;    </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">years_with_data</span><span class="p">:</span>
                <span class="n">years_downloaded_str</span> <span class="o">+=</span> <span class="s1">&#39;    (No Data Available)&#39;</span>

            <span class="n">years_downloaded_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">years_downloaded_str</span><span class="p">:</span>
            <span class="n">years_downloaded_str</span> <span class="o">=</span> <span class="s1">&#39;    NONE</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">status_table</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">primary_rec</span><span class="p">,</span>
                                     <span class="n">receivers</span><span class="p">,</span>
                                     <span class="n">years_downloaded_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">header</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get an ascii table outlining current package settings</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_status_header</span><span class="p">()</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;UTC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PWV&#39;</span><span class="p">:</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PWVerr&#39;</span><span class="p">:</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ZenithDelay&#39;</span><span class="p">:</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SrfcPress&#39;</span><span class="p">:</span> <span class="s1">&#39;mbar&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SrfcTemp&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SrfcRH&#39;</span><span class="p">:</span> <span class="s1">&#39;%&#39;</span>
        <span class="p">}</span>

        <span class="c1"># Add a summary of data cuts for the current site to the status table</span>
        <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">cuts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cuts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">bounds</span> <span class="ow">in</span> <span class="n">cuts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
                        <span class="n">cut_type</span> <span class="o">=</span> <span class="s1">&#39;exclusive&#39;</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cut_type</span> <span class="o">=</span> <span class="s1">&#39;inclusive&#39;</span>

                    <span class="n">status</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                            <span class="n">site</span> <span class="o">+</span>
                            <span class="n">value</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">cut_type</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span> <span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span> <span class="o">+</span>
                            <span class="n">units</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span>


<span class="c1"># This instance should be used package wide to access site settings</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>


<div class="viewcode-block" id="ConfigBuilder"><a class="viewcode-back" href="../../sites_and_settings.html#pwv_kpno.package_settings.ConfigBuilder">[docs]</a><span class="k">class</span> <span class="nc">ConfigBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The ConfigBuilder class is used to build config files for a custom site</span>

<span class="sd">    Default wavelengths and cross sections are provided by MODTRAN estimates</span>
<span class="sd">    and range from 3,000 to 12,000 Angstroms in 0.05 Angstrom increments.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        data_cuts         (dict): Specifies cuts for SuomiNet data</span>
<span class="sd">        site_name          (str): Desired name of the custom site</span>
<span class="sd">        primary_rec        (str): SuomiNet ID code for the primary GPS receiver</span>
<span class="sd">        sup_recs          (list): List of id codes for supplemental receivers</span>
<span class="sd">        wavelengths    (ndarray): Array of wavelengths in Angstroms (optional)</span>
<span class="sd">        cross_sections (ndarray): Array of PWV cross sections in cm^2 (optional)</span>

<span class="sd">    Methods:</span>
<span class="sd">        save_to_dir : Create a custom config file &lt;site_name&gt;.ecsv</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_cuts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primary_rec</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sup_rec</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get the default MODTRAN cross sections used for Kitt Peak</span>
        <span class="n">settings_obj</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
        <span class="n">settings_obj</span><span class="o">.</span><span class="n">set_site</span><span class="p">(</span><span class="s1">&#39;kitt_peak&#39;</span><span class="p">)</span>
        <span class="n">atm_cross_section</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">settings_obj</span><span class="o">.</span><span class="n">_h2o_cs_path</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">atm_cross_section</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">atm_cross_section</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raise_unset_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure user has assigned values to required attributes&quot;&quot;&quot;</span>

        <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;Must specify attribute </span><span class="si">{}</span><span class="s1"> before saving.&#39;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">,</span> <span class="s1">&#39;primary_rec&#39;</span><span class="p">,</span> <span class="s1">&#39;wavelengths&#39;</span><span class="p">,</span> <span class="s1">&#39;cross_sections&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_warn_data_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise warnings if data cuts are not the correct format</span>

<span class="sd">        Data cuts should be of the form:</span>
<span class="sd">            {cut param: [[lower bound, upper bound], ...], ...}</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">dictionary</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cuts</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CUT_PARAMS</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span>
                        <span class="s1">&#39;Provided data cut parameter </span><span class="si">{}</span><span class="s1"> does not correspond&#39;</span>
                        <span class="s1">&#39; to any parameter used by pwv_kpno&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span>
                        <span class="s1">&#39;Cut boundaries for parameter </span><span class="si">{}</span><span class="s1">&#39;</span>
                        <span class="s1">&#39; are not a two dimensional array&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_warn_site_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise warnings if site_name is not the correct format</span>

<span class="sd">        Site names should be lowercase strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="o">.</span><span class="n">islower</span><span class="p">():</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;pwv_kpno uses lowercase site names. The site name </span><span class="si">{}</span><span class="s1"> will be&#39;</span>
                <span class="s1">&#39; saved as </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_warn_id_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise warnings if SuomiNet ID codes are not the correct format</span>

<span class="sd">        SuomiNet ID codes should be four characters long and uppercase.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">all_id_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sup_rec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_id_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_rec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">id_code</span> <span class="ow">in</span> <span class="n">all_id_codes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_code</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;ID is not of expected length 4: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">id_code</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">id_code</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
                <span class="n">warn</span><span class="p">(</span>
                    <span class="s1">&#39;SuomiNet ID codes should be uppercase. ID code </span><span class="si">{}</span><span class="s1"> will&#39;</span>
                    <span class="s1">&#39; be saved as </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">id_code</span><span class="p">,</span> <span class="n">id_code</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_config_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a dictionary with config data for this site</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary storing site settings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_data_cuts</span><span class="p">()</span>
        <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;data_cuts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cuts</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_site_name</span><span class="p">()</span>
        <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;site_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_id_codes</span><span class="p">()</span>
        <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;primary_rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_rec</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;sup_rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">id_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sup_rec</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">config_data</span>

    <span class="k">def</span> <span class="nf">save_to_ecsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># type: (str, bool) -&gt; None</span>
        <span class="sd">&quot;&quot;&quot;Create a custom config file &lt;out_dir&gt;/&lt;self.site_name&gt;.ecsv</span>

<span class="sd">        Args:</span>
<span class="sd">            out_path   (str): The desired output file path ending with .ecsv</span>
<span class="sd">            overwrite (bool): Whether to overwrite an existing file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_unset_attributes</span><span class="p">()</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">create_pwv_atm_model</span><span class="p">(</span><span class="n">mod_lambda</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">),</span>
                                     <span class="n">mod_cs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="p">),</span>
                                     <span class="n">out_lambda</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="p">))</span>

        <span class="n">model</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_config_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.ecsv&#39;</span><span class="p">):</span>
            <span class="n">out_path</span> <span class="o">+=</span> <span class="s1">&#39;.ecsv&#39;</span>

        <span class="n">model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii.ecsv&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s1">&#39;&lt;ConfigBuilder site_name=</span><span class="si">{}</span><span class="s1">, primary_rec=</span><span class="si">{}</span><span class="s1">&gt;&#39;</span>
        <span class="k">return</span> <span class="n">rep</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_rec</span><span class="p">)</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018, Daniel J. Perrefort.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>