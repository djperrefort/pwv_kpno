<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3. Customizing Data Cuts &#8212; pwv_kpno 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/custom_style.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="2. Correcting Photometric Observations" href="correcting_photometry.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../documentation/html/index.html">
          pwv_kpno</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../documentation/html/install.html">Documentation</a></li>
                <li><a href="../../examples/html/correcting_spectra.html">Examples</a></li>
                <li><a href="../../validation/html/overview.html">Validation</a></li>
                <li><a href="https://github.com/mwvgroup/pwv_kpno/issues/new/choose">Need Help?</a></li>
                <li><a href="https://github.com/mwvgroup/pwv_kpno">Source Code</a></li>
            
            
            
            
            
          </ul>

          
                 
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="correcting_spectra.html">1. Correcting Spectrographic Observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="correcting_photometry.html">2. Correcting Photometric Observations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Customizing Data Cuts</a></li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="customizing-data-cuts">
<h1>3. Customizing Data Cuts<a class="headerlink" href="#customizing-data-cuts" title="Permalink to this headline">¶</a></h1>
<p>For various reasons, you may wish to apply cuts to the SuomiNet measurements
used by <strong>pwv_kpno</strong>. The most obvious use case would be to ignore a period of
time when a SuomiNet weather station was experiencing technical difficulties,
or if there is some unexplained, unphysical spike in the measurements. For
convenience, we demonstrate how to visually explore various choices in data cuts.</p>
<p>Following SuomiNet’s naming convention, values that can be cut include the PWV
(<code class="docutils literal notranslate"><span class="pre">PWV</span></code>), PWV error (<code class="docutils literal notranslate"><span class="pre">PWVerr</span></code>), surface pressure (<code class="docutils literal notranslate"><span class="pre">SrfcPress</span></code>),
surface temperature (<code class="docutils literal notranslate"><span class="pre">SrfcTemp</span></code>), and relative humidity (<code class="docutils literal notranslate"><span class="pre">SrfcRH</span></code>).
The current data cuts can be accessed via the <code class="docutils literal notranslate"><span class="pre">settings</span></code> object.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pwv_kpno.package_settings</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">data_cuts</span><span class="p">)</span>

<span class="go">  {&#39;AZAM&#39;: {&#39;SrfcPress&#39;: [[880, 925]]},</span>
<span class="go">   &#39;KITT&#39;: {&#39;SrfcPress&#39;: [[775, 1000]], &#39;date&#39;: [[1451606400.0, 1459468800.0]]},</span>
<span class="go">   &#39;P014&#39;: {&#39;SrfcPress&#39;: [[870, 1000]]},</span>
<span class="go">   &#39;SA46&#39;: {&#39;SrfcPress&#39;: [[900, 1000]]},</span>
<span class="go">   &#39;SA48&#39;: {&#39;SrfcPress&#39;: [[910, 1000]]}</span>
<span class="go">  }</span>
</pre></div>
</td></tr></table></div>
<p>These data cuts can be changed by directly modifying the <code class="docutils literal notranslate"><span class="pre">data_cuts</span></code> attribute. For
example, if we wanted to ignore measurements taken between two dates, we can specify
those dates as UTC timestamps and run</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_cuts</span><span class="p">[</span><span class="s1">&#39;AZAM&#39;</span><span class="p">]</span> <span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">{</span><span class="s1">&#39;SrfcPress&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="p">[</span><span class="n">timestamp_start</span><span class="p">,</span> <span class="n">timestamp_end</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>     <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Note that inorder for these changes to take full effect, the PWV model for the primary
site must be updated. This must be performed even if you are modeling a custom site
without any supplimental receivers:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pwv_kpno</span> <span class="kn">import</span> <span class="n">pwv_atm</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">years_to_download</span> <span class="o">=</span> <span class="n">pwv_atm</span><span class="o">.</span><span class="n">downloaded_years</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pwv_atm</span><span class="o">.</span><span class="n">update_models</span><span class="p">(</span><span class="n">years_to_download</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>We can visually inspect these cuts by using the <code class="docutils literal notranslate"><span class="pre">get_all_receiver_data</span></code> to retrieve the
the data with and without the cuts applied and then plotting them as follows:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">setdiff</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pwv_kpno</span> <span class="kn">import</span> <span class="n">pwv_atm</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">plot_data_cuts</span><span class="p">(</span><span class="n">receiver_id</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;&quot;&quot;Plots PWV vs Temperature, Pressure, and RH at a given SuomiNet site</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">Args</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">receiver_id</span> <span class="p">(</span><span class="nb">str</span><span class="p">):</span> <span class="n">A</span> <span class="n">SuomiNet</span> <span class="n">receiver</span> <span class="nb">id</span> <span class="n">code</span> <span class="p">(</span><span class="n">eg</span><span class="o">.</span> <span class="n">KITT</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s2">&quot;&quot;&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Clear any pre-existing plot data</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">8.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Get SuomiNet data with and without data cuts</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">all_data</span> <span class="o">=</span> <span class="n">pwv_atm</span><span class="o">.</span><span class="n">get_all_receiver_data</span><span class="p">(</span><span class="n">receiver_id</span><span class="p">,</span> <span class="n">apply_cuts</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">data_with_cuts</span> <span class="o">=</span> <span class="n">pwv_atm</span><span class="o">.</span><span class="n">get_all_receiver_data</span><span class="p">(</span><span class="n">receiver_id</span><span class="p">,</span> <span class="n">apply_cuts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">cut_data</span> <span class="o">=</span> <span class="n">setdiff</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">data_with_cuts</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Temperature data</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;PWV for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receiver_id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">temp_axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">temp_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_with_cuts</span><span class="p">[</span><span class="s1">&#39;SrfcTemp&#39;</span><span class="p">],</span> <span class="n">data_with_cuts</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">temp_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cut_data</span><span class="p">[</span><span class="s1">&#39;SrfcTemp&#39;</span><span class="p">],</span> <span class="n">cut_data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">temp_axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SrfcTemp&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">temp_axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">temp_axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">temp_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Pressure data</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">press_axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">press_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_with_cuts</span><span class="p">[</span><span class="s1">&#39;SrfcPress&#39;</span><span class="p">],</span> <span class="n">data_with_cuts</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">press_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cut_data</span><span class="p">[</span><span class="s1">&#39;SrfcPress&#39;</span><span class="p">],</span> <span class="n">cut_data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">press_axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SrfcPress&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">press_axis</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">press_axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">650</span><span class="p">,</span> <span class="mi">850</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">press_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Relative humidity data</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rh_axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rh_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_with_cuts</span><span class="p">[</span><span class="s1">&#39;SrfcRH&#39;</span><span class="p">],</span> <span class="n">data_with_cuts</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rh_axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cut_data</span><span class="p">[</span><span class="s1">&#39;SrfcRH&#39;</span><span class="p">],</span> <span class="n">cut_data</span><span class="p">[</span><span class="s1">&#39;PWV&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rh_axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RH&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rh_axis</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rh_axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">rh_axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_data_cuts</span><span class="p">(</span><span class="s1">&#39;KITT&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/data_cuts.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2018, Daniel J. Perrefort.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>